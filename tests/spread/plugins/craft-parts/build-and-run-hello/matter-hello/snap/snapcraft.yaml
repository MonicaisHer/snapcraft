name: matter-hello
version: "1.0"
summary: simple matter application
description: build an example lighting application using Matter SDK and say "hello world"
base: core22
confinement: strict

apps:
  lighting:
    daemon: simple
    install-mode: disable
    command: bin/lighting-app
    plugs:
      - network
      - network-bind
      - bluez
      - avahi-control
      - gpio-memory-control
      - otbr-dbus-wpan0

parts:
  lighting-hello:
    plugin: matter
    matter-sdk-version: "master"
    matter-zap-version: "v2023.11.13"
    source: app
    override-build: |
      craftctl default
      cd $CRAFT_PART_BUILD/matter

      # Build a lighting example

      cd examples/lighting-app/linux
      gn gen out/build --args='is_debug=true'
      ninja -C out/build

      # ldd out/build/chip-lighting-app
      
      # mkdir -p $CRAFT_PART_INSTALL/bin
      # cp out/build/chip-lighting-app $CRAFT_PART_INSTALL/bin/lighting-app        
    build-packages:
      - gcc
      - git
      - g++
      - libdbus-1-dev
      - libglib2.0-dev
      - libssl-dev
      - ninja-build
      - pkg-config
      - python-is-python3
      - python3-dev
      - python3-venv
      - unzip

