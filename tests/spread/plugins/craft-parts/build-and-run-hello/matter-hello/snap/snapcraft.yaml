name: matter-hello
version: "1.0"
summary: simple matter application
description: build an example lighting application using the Matter SDK and say "hello world"
base: core22
confinement: strict

apps:
  matter-hello:
    command: bin/lighting-app

parts:
  lighting-hello:
    plugin: matter
    matter-sdk-version: "master"
    matter-zap-version: "v2023.11.13"
    source: app
    override-build: |
      craftctl default
      cd $CRAFT_PART_BUILD/matter

      set +u && source scripts/setup/bootstrap.sh --platform build && set -u

      # Copy and replace the application files so that it will say "hello world"
      cp -vr $CRAFT_PART_BUILD/main.cpp examples/lighting-app/linux/main.cpp

      # Build a lighting example
      cd examples/lighting-app/linux
      gn gen out/build
      ninja -C out/build

      ldd out/build/chip-lighting-app
      
      mkdir -p $CRAFT_PART_INSTALL/bin
      cp out/build/chip-lighting-app $CRAFT_PART_INSTALL/bin/lighting-app        


