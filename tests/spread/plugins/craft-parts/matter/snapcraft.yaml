name: matter-lighting
summary: Matter plugin test
description: An lighting application to test the matter plugin.

grade: stable
build-base: core22
confinement: strict

layout:
  /mnt:
    bind: $SNAP_COMMON/mnt

apps:
  matter-lighting:
    command: bin/lighting-app

parts:
  matter-lighting:
    plugin: matter
    matter-sdk-version: "master"
    matter-zap-version: "v2023.11.13"
    source: app
    override-build: |
      craftctl default
      cd $CRAFT_PART_BUILD/matter

      # Overwrite the main application file so that it prints "hello world"
      cp -v $CRAFT_PART_BUILD/main.cpp examples/lighting-app/linux/main.cpp

      cd examples/lighting-app/linux
      gn gen out/build
      ninja -C out/build

      ldd out/build/chip-lighting-app
      
      mkdir -p $CRAFT_PART_INSTALL/bin
      cp out/build/chip-lighting-app $CRAFT_PART_INSTALL/bin/lighting-app   

